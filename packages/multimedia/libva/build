#!/bin/sh

. config/options

get_meta $1
cd $PKG_BUILD_DIR

if pkg_uses x11 ; then
  BUILD_OPTIONS="--enable-x11 --disable-glx --disable-wayland"
elif pkg_uses wayland ; then
  BUILD_OPTIONS="--disable-x11 --disable-glx --enable-wayland"
else
  BUILD_OPTIONS="-disable-x11 --disable-glx --disable-wayland"
fi


do_configure \
  $BUILD_OPTIONS \
  --with-drivers-path=$XORG_PATH_VAAPI \
  --disable-dummy-driver \
  --disable-dummy-backend \
  --disable-egl \
  --with-gnu-ld \
  --disable-silent-rules \

make
make_install

sed -i "s%^driverdir=.*%driverdir=$XORG_PATH_VAAPI%" \
  .install/usr/lib/pkgconfig/libva.pc
