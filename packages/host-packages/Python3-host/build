#!/bin/sh

. config/options

get_meta $1
cd $PKG_BUILD_DIR

export LDFLAGS="$HOST_LDFLAGS -Wl,--enable-new-dtags"
ac_cv_prog_HAS_HG=/bin/false

do_autoconf
do_configure host \
             --without-ensurepip \
             --without-cxx-main \
             --disable-sqlite3 \
             --disable-tk \
             --with-expat=system \
             --disable-curses \
             --disable-codecs-cjk \
             --disable-nis \
             --enable-unicodedata \
             --disable-test-modules \
             --disable-idle3 \
             --disable-ossaudiodev \
             --disable-openssl

make
make_install toolchain

rm -f .install/usr/bin/python*-config
rm -f .install/usr/bin/smtpd.py*
rm -f .install/usr/bin/pyvenv
rm -f .install/usr/bin/pydoc*
rm -f .install/usr/bin/2to3

cp Tools/scripts/reindent.py .install/usr/lib/python3.6
