#!/bin/sh

. config/options

get_meta $1
cd $PKG_BUILD_DIR

do_cmake_build \
    -DFLATBUFFERS_BUILD_FLATC=OFF \
    -DFLATBUFFERS_BUILD_FLATHASH=OFF \
    -DFLATBUFFERS_BUILD_TESTS=OFF \
    -DFLATBUFFERS_BUILD_GRPCTEST=OFF

rm -rf .build-host
mkdir .build-host
cd .build-host

setup_toolchain host

cmake \
    -DCMAKE_SYSTEM_NAME=Linux \
    -DCMAKE_FIND_ROOT_PATH=$LIB_PREFIX \
    -DCMAKE_FIND_ROOT_PATH_MODE_INCLUDE=ONLY \
    -DCMAKE_FIND_ROOT_PATH_MODE_LIBRARY=ONLY \
    -DCMAKE_FIND_ROOT_PATH_MODE_PROGRAM=NEVER \
    -DCMAKE_FIND_NO_INSTALL_PREFIX=1 \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DFLATBUFFERS_BUILD_FLATC=ON \
    -DFLATBUFFERS_BUILD_FLATHASH=ON \
    -DFLATBUFFERS_BUILD_TESTS=OFF \
    -DFLATBUFFERS_BUILD_GRPCTEST=OFF \
    -DFLATBUFFERS_BUILD_FLATLIB=OFF \
    ..

make

mkdir -p ../.install/usr/bin
cp flatc flathash ../.install/usr/bin

