#!/bin/sh

. config/options

get_meta $1
cd $PKG_BUILD_DIR

GCC_NO_GOLD=1 GCC_NO_LTO=1 GCC_NO_OFFSET_64=1 \
do_autoconf
do_remove_werror_calls
do_configure \
  --disable-option-checking \
  --enable-thread-safety \
  --disable-mudflap \
  --disable-nls \
  --with-zlib \
  --with-bzlib \

make
make_install

pc_dir=.install/usr/lib/pkgconfig
mkdir -p $pc_dir

for l in libelf libdw; do
  sed -e "s:=/usr:=${LIB_PREFIX}:" -e "s:@VERSION@:${PKG_VERSION}:" \
    $ROOT/$PACKAGES/$PKG_SECTION/$PKG_NAME/config/${l}.pc > $pc_dir/${l}.pc
done

exit 0
